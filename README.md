# 1. Install docker 

Follow the [Installation guide](https://docs.docker.com/install/linux/docker-ce/debian/#install-docker-ce-1).

## 1.1. Installation version dated from 2019-02-13 (refer to the previous link)
```bash
 sudo apt-get update

 sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg2 \
    software-properties-common
```

## 1.2. Add Docker’s official GPG key:
```bash
sudo apt-key fingerprint 0EBFCD88

pub   4096R/0EBFCD88 2017-02-22
      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid                  Docker Release (CE deb) <docker@docker.com>
sub   4096R/F273FCD8 2017-02-22
```

## 1.3. Use the following command to set up the stable repository.
```bash
sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/debian \
   $(lsb_release -cs) \
   stable"
```

## 1.4. Configure Docker as non root user 
user=phis

```bash
sudo groupadd docker
```
```
sudo usermod -aG docker $user
sudo chown $user:$user /home/$user/.docker -R
sudo chmod g+rwx /home/"$user"/.docker" -R
```

## 1.5. Configure to start 
sudo systemctl enable docker

# 2. Configure Docker DNS 

## 2.1. for ubuntu

Run the following command :

```bash
nmcli dev show | grep 'IP4.DNS'
```

The excepted result is above :

```bash
IP4.DNS[1]:                             147.99.0.248
IP4.DNS[2]:                             147.99.0.249
```

## 2.2. for debian

```bash
more  /etc/resolv.conf
# Generated by NetworkManager
nameserver 138.102.210.7
nameserver 147.100.166.31
```

## 2.3. Connect with root account

```bash
sudo su
```

## 2.4. Set right docker DNS

```bash
sudo su
echo "{\"dns\": [\"YOUR_DNS_1_IP_HERE\", \"YOUR_DNS_2_IP_HERE\"]}" > /etc/docker/daemon.json
```

- daemon.json file content example :

```json
{
  "dns": ["147.99.0.248", "147.99.0.249"]
}
```

## 2.5. restart docker and from root:

```bash
 service docker restart

 exit
```

<!-- # Configure apache

sudo a2enmod proxy proxy_http


cd /etc/apache2/sites-available

nano opcu.conf

```bash
   <VirtualHost *:80>
      ServerName 138.102.159.37 # Adresse principale 
      ServerAlias 138.102.159.37 # Aliases du domaine, si l'adresse ou les adresses sont utilisée, on pointe au même endroit, facultatif
   # ServerAdmin postmaster@domaine1.example # Adresse email de l'admin du domaine, facultatif
      #DocumentRoot /var/www/domaine1.example # Répertoire où pointe le domaine
      ProxyPass / http://138.102.159.37:8004/
      ProxyPassReverse / http://138.102.159.37:8004/
      ProxyPreserveHost On
   </VirtualHost>
``` -->


# 3. Run docker image

- example :

```bash
docker run -d -t -p 8004:8004  -e github='https://github.com/niio972/ocpu-docker.git' --name=opensilex-ocpu opensilex/ocpu:latest
# or
# if you want to link a host folder and container folder
# docker run -v {host_scripts_path}:/home/opencpu/scripts --name opencpu-server -t -p 8004:8004 opencpu/rstudio
```

# 4. How to move an R package from host to container {host_scripts_path} and install it

- example :

```bash
install.packages("/home/opencpu/scripts/webapp_0.1.1.tar.gz",repos=NULL,type ="source")
```

# To uninstall docker :  https://docs.docker.com/install/linux/docker-ce/debian/#uninstall-docker-ce